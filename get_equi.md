Identifying additional stopwords by GloVe
================
Chung-hong Chan

``` r
require(quanteda)
```

    ## Loading required package: quanteda

    ## Package version: 2.0.0

    ## Parallel computing: 2 of 4 threads used.

    ## See https://quanteda.io for tutorials and examples.

    ## 
    ## Attaching package: 'quanteda'

    ## The following object is masked from 'package:utils':
    ## 
    ##     View

``` r
require(text2vec)
```

    ## Loading required package: text2vec

``` r
get_equivalent <- function(x, seeds) {
    ##stopifnot(is.fcm(x))
    y <- dfm_select(x, seeds)
    x <- dfm_remove(x, seeds)
    temp <- proxyC::simil(x, y, margin = 2)
    sort(apply(temp, 1, max), decreasing = TRUE)
}

hk_pr <- unlist(tokens(readRDS('hk_pr.RDS'), what = "sentence"))
names(hk_pr) <- seq(1, length(hk_pr))
stop_words <- dictionary(file = "stopwords_zh_traditional.yml")


## hk_pr %>% tokens(remove_punct = TRUE) %>% fcm("window", window = 1, tri = FALSE, ordered = TRUE) -> hk_pr_fcm


## head(get_equivalent(hk_pr_fcm, unlist(stop_words$pronoun)), 30)

pr_fcm2 <- fcm(tokens(hk_pr), context = "window", count = "weighted", weights = 1 / (1:5), tri = TRUE)
glove <- GlobalVectors$new(rank = 50, x_max = 10)
wv_main <- glove$fit_transform(pr_fcm2, n_iter = 40,
                               convergence_tol = 0.01, n_threads = 8)
```

    ## INFO  [13:38:34.571] epoch 1, loss 0.3423 
    ## INFO  [13:38:43.749] epoch 2, loss 0.2506 
    ## INFO  [13:38:52.217] epoch 3, loss 0.2216 
    ## INFO  [13:39:00.406] epoch 4, loss 0.2071 
    ## INFO  [13:39:08.795] epoch 5, loss 0.1981 
    ## INFO  [13:39:16.986] epoch 6, loss 0.1918 
    ## INFO  [13:39:25.083] epoch 7, loss 0.1872 
    ## INFO  [13:39:33.287] epoch 8, loss 0.1836 
    ## INFO  [13:39:41.538] epoch 9, loss 0.1806 
    ## INFO  [13:39:50.688] epoch 10, loss 0.1782 
    ## INFO  [13:39:59.011] epoch 11, loss 0.1762 
    ## INFO  [13:40:10.749] epoch 12, loss 0.1745 
    ## INFO  [13:40:10.752] Success: early stopping. Improvement at iterartion 12 is less then convergence_tol

``` r
wv_context <- glove$components
word_vectors <- wv_main + t(wv_context)
wv_dfm <- t(as.dfm(word_vectors))
```

``` r
head(get_equivalent(wv_dfm, unlist(stop_words)), 400)
```

    ##    十八日      九日    十一日    十三日      七日    十六日      八日 
    ## 0.9695983 0.9657761 0.9652321 0.9630648 0.9623467 0.9615443 0.9606791 
    ##      五日      二日      四日      六日         ○      三日    三十日 
    ## 0.9592203 0.9584579 0.9570820 0.9543125 0.9501571 0.9488323 0.9428822 
    ##      十日      一日      族裔      七時    十四日      相信      其實 
    ## 0.9397533 0.9381515 0.9340664 0.9316768 0.9295159 0.9289382 0.9200434 
    ##      一二      包括        ，      都是        要      九時      覺得 
    ## 0.9165066 0.9143729 0.9123749 0.9105915 0.9083998 0.9065716 0.9064053 
    ##      知道      就是    並不是      相關      希望      很多        、 
    ## 0.9039266 0.9024895 0.8995123 0.8941629 0.8936015 0.8904421 0.8888716 
    ##      八時      六時      五年      也是      十時        等      有否 
    ## 0.8867816 0.8823961 0.8819617 0.8810333 0.8792741 0.8792304 0.8772031 
    ##      雖然      當然      當中      三年      現在    二十四      一個 
    ## 0.8762755 0.8757234 0.8750265 0.8743216 0.8741936 0.8739786 0.8732752 
    ##      五時      一五      大家      亦有      有些        約    這方面 
    ## 0.8730223 0.8713293 0.8702965 0.8692048 0.8676315 0.8669589 0.8668258 
    ##      四年        呢        餉      除了      來說      可以        想 
    ## 0.8655329 0.8625397 0.8624294 0.8611080 0.8597610 0.8588929 0.8581031 
    ##      認為        遙      影響      原因      沒有        問        會 
    ## 0.8580768 0.8571077 0.8568983 0.8566827 0.8560423 0.8560327 0.8560128 
    ##      究竟      是否      大約    會不會      二十      一定      記者 
    ## 0.8541429 0.8535906 0.8530561 0.8530368 0.8502854 0.8479891 0.8471459 
    ##      同時      二時      一六    有沒有      時候      政府      一年 
    ## 0.8463253 0.8457622 0.8428144 0.8415752 0.8412054 0.8409985 0.8402757 
    ##        ？      看看      真的      上述    為甚麼      都有      今天 
    ## 0.8402308 0.8399941 0.8399913 0.8390570 0.8386751 0.8384544 0.8380342 
    ##    我認為      不同      剛才      看到      即是      若有        將 
    ## 0.8375174 0.8359004 0.8352588 0.8340299 0.8323306 0.8316351 0.8315189 
    ##      現時      明白      方面      能夠        去    其實是        零 
    ## 0.8299552 0.8286916 0.8275008 0.8263526 0.8253222 0.8238218 0.8210138 
    ##      將於      要求      重要      建議        。      也有      相當 
    ## 0.8208795 0.8204313 0.8201432 0.8194023 0.8184678 0.8183282 0.8181078 
    ##      都不      一千      說過      無論        已      不會        所 
    ## 0.8179077 0.8178139 0.8173770 0.8169517 0.8160406 0.8160286 0.8159801 
    ##      部分      一樣      已經      更加      具體      還是      例如 
    ## 0.8151363 0.8145480 0.8124361 0.8118603 0.8106224 0.8101538 0.8101440 
    ##    實際上      十九      一三      十一      十七      也好      今次 
    ## 0.8101348 0.8082206 0.8079809 0.8058976 0.8053237 0.8053159 0.8052460 
    ##        ；      已於      十二        嶽      按照      我也      局長 
    ## 0.8044994 0.8042213 0.8036729 0.8031261 0.8027521 0.8021060 0.8018787 
    ##        了      他們      失實      需要    事實上        棄      接近 
    ## 0.8015758 0.8001842 0.7988273 0.7980520 0.7975061 0.7967041 0.7966984 
    ##      十五      提供    應該是      二千    是不是      關注        50 
    ## 0.7957406 0.7954443 0.7944587 0.7940418 0.7939631 0.7925646 0.7913132 
    ##        起      首先       000      我想      香港      今日      問題 
    ## 0.7912628 0.7911505 0.7905490 0.7903148 0.7902891 0.7898091 0.7895986 
    ##        做        被        個        則      去年      老街      提到 
    ## 0.7891820 0.7887893 0.7875161 0.7869144 0.7868004 0.7866792 0.7863182 
    ##      繼續        讓      是有      考慮      指出      作出      都會 
    ## 0.7861220 0.7850481 0.7837828 0.7832198 0.7832186 0.7821935 0.7820665 
    ##        須      你會      明日        裏      的是      好像      今年 
    ## 0.7819783 0.7804323 0.7800342 0.7799182 0.7796379 0.7782023 0.7777547 
    ##        能      情況       500      另一      主要      有助      六百 
    ## 0.7768086 0.7766453 0.7766063 0.7764142 0.7763593 0.7753716 0.7752788 
    ##      分別      五百      也會      譬如      就會      自己      探討 
    ## 0.7750332 0.7748179 0.7746931 0.7732874 0.7730492 0.7730255 0.7730140 
    ##      進行      一直  無論如何        仍      報章  目前為止      完成 
    ## 0.7726464 0.7722522 0.7717722 0.7714706 0.7709165 0.7707837 0.7702609 
    ##      關心    並沒有      等等      當局        可      時間      另外 
    ## 0.7701975 0.7699523 0.7699158 0.7675733 0.7668589 0.7666569 0.7662313 
    ##       100      就算      理解      鼓勵      吸引      得到      傍晚 
    ## 0.7656809 0.7655052 0.7652340 0.7649269 0.7648740 0.7641818 0.7641317 
    ##        才      低於        它      甚至      擔心      草案      仍然 
    ## 0.7637698 0.7634871 0.7634230 0.7630877 0.7627646 0.7622889 0.7618251 
    ##        40      說的        逾      資料      七百        看      十六 
    ## 0.7600300 0.7598986 0.7596321 0.7593419 0.7583390 0.7579784 0.7577089 
    ##      二百      高興        局      工作      並無      看法      五分 
    ## 0.7576600 0.7575806 0.7572962 0.7571785 0.7570722 0.7567339 0.7559944 
    ##        ）      五千        使      你說      有何       700      儘管 
    ## 0.7557472 0.7555941 0.7551537 0.7544558 0.7541769 0.7539162 0.7535987 
    ##      並非      是在      參與    可能會      並會      重視       300 
    ## 0.7533074 0.7532818 0.7532377 0.7527873 0.7526505 0.7514281 0.7513861 
    ##      必須      特區      始終      協助      所謂      虛假      造成 
    ## 0.7512311 0.7511322 0.7503845 0.7501584 0.7500880 0.7495959 0.7491654 
    ##      兩個      管理      事情        把      三百        署      正如 
    ## 0.7488872 0.7484252 0.7477732 0.7476849 0.7476425 0.7470785 0.7467415 
    ##      恐怕      意思        ：      起碼      一九    不需要      不准 
    ## 0.7466198 0.7465700 0.7464606 0.7460818 0.7458767 0.7455346 0.7455049 
    ##      並且      整個      不盡    當然是      有效      四千      並不 
    ## 0.7452368 0.7447283 0.7442736 0.7434895 0.7431825 0.7427353 0.7419604 
    ##      一時    十六歲      以致      九年      開始      意見    一方面 
    ## 0.7418179 0.7416667 0.7412792 0.7409027 0.7408408 0.7405907 0.7405665 
    ##      左右      詳細      目前        者      十分      翌日      改善 
    ## 0.7403180 0.7401930 0.7393920 0.7393518 0.7392666 0.7387256 0.7385177 
    ##      也要      我在      八百      四百      都要       400        話 
    ## 0.7380719 0.7379629 0.7377530 0.7373565 0.7372427 0.7369179 0.7366695 
    ##      年底      昨日      從而    不知道      我是      落實        １ 
    ## 0.7364926 0.7361904 0.7355988 0.7355557 0.7350463 0.7348308 0.7346259 
    ##      正因        指      未來      不能        （        當      剛剛 
    ## 0.7346178 0.7343428 0.7341977 0.7340953 0.7338997 0.7335841 0.7334617 
    ##    我知道      發展      共有      針對      方案      支持    差不多 
    ## 0.7331396 0.7327173 0.7326779 0.7326350 0.7324209 0.7323642 0.7321386 
    ##       200      研究      三千        兩    只不過      一般        題 
    ## 0.7315117 0.7308079 0.7305879 0.7304897 0.7300758 0.7300059 0.7294684 
    ##      做法      受到      絕對      現行        20      學年      評估 
    ## 0.7293764 0.7293053 0.7292812 0.7292700 0.7291683 0.7290062 0.7285029 
    ##      出現      才會        人    下一步      聽到      去到      機構 
    ## 0.7283933 0.7277646 0.7276754 0.7275663 0.7265950 0.7263660 0.7257639 
    ##      提及        訪      還有      審議      若是        ０      期望 
    ## 0.7256641 0.7255092 0.7254960 0.7253848 0.7251959 0.7251626 0.7247633 
    ##      方式      一百      這類       800        之      討論  三分之二 
    ## 0.7243770 0.7242902 0.7242534 0.7231490 0.7227494 0.7227444 0.7227089 
    ##      將在      議員      安排        本  時至今日      以往    都沒有 
    ## 0.7226386 0.7224834 0.7220749 0.7219214 0.7218668 0.7216462 0.7215991 
    ##      盡量      符合        耕    委員會      做的      社會        10 
    ## 0.7215087 0.7213935 0.7210883 0.7206345 0.7205399 0.7205277 0.7203882 
    ##      不少      會有      凌晨    十五歲      專業      你有      說是 
    ## 0.7203326 0.7203121 0.7199145 0.7198040 0.7195870 0.7191022 0.7189863 
    ##      十八      星期      加強      利用        30      將來        」 
    ## 0.7189051 0.7185291 0.7179288 0.7178463 0.7177289 0.7176624 0.7176158 
    ##        便    越來越        ２      過去        ３    十九歲      立法 
    ## 0.7175324 0.7170760 0.7170052 0.7169102 0.7168903 0.7168086 0.7160498 
    ##      三十      地區        來      服務      未能      月底      能否 
    ## 0.7157181 0.7153854 0.7149911 0.7147468 0.7147329 0.7146106 0.7144479 
    ##      六千 
    ## 0.7143301
